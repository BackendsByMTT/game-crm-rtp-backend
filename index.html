<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket.IO Platform & Game</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: #1e1e2e;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    .container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 2.5rem;
      color: #f8f8f2;
      text-align: center;
      text-shadow: 0 0 10px rgba(189, 147, 249, 0.7);
    }

    .status-cards {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      flex: 1;
      background: #282a36;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #bd93f9;
    }

    .status {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .connected {
      background-color: #50fa7b;
      color: #282a36;
    }

    .disconnected {
      background-color: #ff5555;
      color: #f8f8f2;
    }

    .login-panel {
      background: #282a36;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      width: 100%;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    input {
      flex: 1;
      padding: 12px 15px;
      border: none;
      background: #44475a;
      color: #f8f8f2;
      border-radius: 8px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s;
    }

    input:focus {
      box-shadow: 0 0 0 2px #bd93f9;
    }

    input::placeholder {
      color: #6272a4;
    }

    button {
      background: #bd93f9;
      color: #282a36;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
    }

    button:hover {
      background: #a58eed;
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .game-controls {
      background: #282a36;
      border-radius: 12px;
      padding: 25px;
      width: 100%;
      display: none;
    }

    .controls-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .controls-title {
      font-size: 1.5rem;
      color: #bd93f9;
    }

    .spin-buttons {
      display: flex;
      gap: 15px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .spin-button {
      flex: 1;
      min-width: 120px;
      padding: 15px;
      text-align: center;
    }

    .primary-button {
      background: linear-gradient(135deg, #bd93f9, #9580ec);
    }

    .secondary-button {
      background: linear-gradient(135deg, #8be9fd, #50fa7b);
    }

    .auto-spin-container {
      margin-top: 20px;
      background: #44475a;
      border-radius: 8px;
      padding: 15px;
    }

    .auto-spin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .spin-counter {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .counter-button {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #6272a4;
      border-radius: 4px;
      padding: 0;
    }

    #spin-count {
      font-size: 1.2rem;
      font-weight: 600;
      color: #f8f8f2;
    }

    .result-display {
      margin-top: 20px;
      background: #44475a;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }

    #result-text {
      font-size: 1.2rem;
      font-weight: 600;
      color: #f8f8f2;
    }

    .win {
      color: #50fa7b !important;
    }

    .lose {
      color: #ff5555 !important;
    }
  </style>
</head>


<body>
  <div class="container">
    <h1>Slot Game Platform</h1>

    <div class="status-cards">
      <div class="card">
        <h2>Platform Connection</h2>
        <span id="platform-status" class="status disconnected">Disconnected</span>
      </div>
      <div class="card">
        <h2>Game Connection</h2>
        <span id="game-status" class="status disconnected">Disconnected</span>
      </div>
    </div>

    <div class="login-panel">
      <div class="input-group">
        <input type="text" id="username" placeholder="Enter your username">
        <input type="text" id="playground-id" placeholder="Playground ID">
        <button onclick="connectToPlayground()">Connect to Playground</button>
      </div>
      <div class="input-group" style="margin-top: 10px;">
        <button onclick="connectGame()" id="game-connect-btn" disabled>Connect to Game</button>
      </div>
    </div>

    <div id="game-controls" class="game-controls">
      <!-- ...existing code... -->
    </div>

    <div id="alerts" class="alerts"
      style="margin-top: 20px; background: #44475a; border-radius: 8px; padding: 15px; display: none;">
      <h3>System Alerts</h3>
      <div id="alert-messages" style="max-height: 150px; overflow-y: auto;"></div>
    </div>
  </div>

  <script>
    // Auth token - you should implement a proper login system to get this
    const authToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3MTlkNzQ3NTBiOWUyNDVjYmFjNjdjZCIsInVzZXJuYW1lIjoidGVzdC1wbGF5ZXItNCIsInJvbGUiOiJwbGF5ZXIiLCJpYXQiOjE3NDE3NzUxNzUsImV4cCI6MTc0MjM3OTk3NX0.1gFQIGI8bGlvlqVwXD4D4aHjfjami7Aweps_dFLP-5c";

    // Socket connections
    let playgroundSocket = null;
    let gameSocket = null;

    // Game state
    let balance = 1000;
    let autoSpinCount = 10;
    let isAutoSpinning = false;
    let autoSpinInterval = null;

    // Connect to the playground namespace
    function connectToPlayground() {
      const username = document.getElementById('username').value.trim();
      const playgroundId = document.getElementById('playground-id').value.trim();

      if (!username) {
        showAlert("Please enter a username first!", "error");
        return;
      }

      if (!playgroundId) {
        showAlert("Please enter a playground ID!", "error");
        return;
      }

      // Prevent multiple connections
      if (playgroundSocket) {
        playgroundSocket.disconnect();
      }

      // Connect to playground namespace
      playgroundSocket = io('http://localhost:5001/playground', {
        withCredentials: true,
        auth: {
          token: authToken,
          playgroundId: playgroundId
        }
      });

      playgroundSocket.on('connect', () => {
        document.getElementById('platform-status').innerText = "Connected";
        document.getElementById('platform-status').className = "status connected";
        showAlert("✅ Connected to Playground", "success");

        // Enable game connect button
        document.getElementById('game-connect-btn').disabled = false;
      });

      playgroundSocket.on('disconnect', () => {
        document.getElementById('platform-status').innerText = "Disconnected";
        document.getElementById('platform-status').className = "status disconnected";
        showAlert("❌ Disconnected from Playground", "error");

        // Disable game connect button
        document.getElementById('game-connect-btn').disabled = true;
      });

      playgroundSocket.on('error', (error) => {
        showAlert(`Error: ${error.message}`, "error");
        playgroundSocket.disconnect();
      });

      playgroundSocket.on('alert', (data) => {
        showAlert(data.message, data.type || "info");
      });



      playgroundSocket.on('kicked', (data) => {
        showAlert(`You were kicked: ${data.message}`, "error");
        playgroundSocket.disconnect();
      });
    }

    // Connect to the game namespace
    function connectGame() {
      const username = document.getElementById('username').value.trim();

      if (!playgroundSocket || !playgroundSocket.connected) {
        showAlert("You must connect to a Playground first!", "error");
        return;
      }

      // Prevent multiple connections
      if (gameSocket) {
        gameSocket.disconnect();
      }

      gameSocket = io('http://localhost:5001/game', {
        withCredentials: true,
        auth: {
          token: authToken,
          gameId: "TEST GAME ID"
        },
      });

      gameSocket.on('connect', () => {
        document.getElementById('game-status').innerText = "Connected";
        document.getElementById('game-status').className = "status connected";
        showAlert("🎮 Connected to Game", "success");

        // Show game controls
        document.getElementById('game-controls').style.display = 'block';

        // Send username to the server
        gameSocket.emit('join', { username });
      });

      gameSocket.on('disconnect', () => {
        document.getElementById('game-status').innerText = "Disconnected";
        document.getElementById('game-status').className = "status disconnected";
        showAlert("❌ Disconnected from Game", "error");

        // Hide game controls
        document.getElementById('game-controls').style.display = 'none';

        // Stop auto-spin if active
        stopAutoSpin();
      });

      gameSocket.on('error', (error) => {
        showAlert(`Game Error: ${error.message}`, "error");
      });

      gameSocket.on('spin-result', (data) => {
        const resultElement = document.getElementById('result-text');
        resultElement.innerText = `${data.result}`;
        resultElement.className = data.result === 'Win' ? 'win' : 'lose';

        // Update balance based on result
        if (data.result === 'Win') {
          balance += 50;
        } else {
          balance -= 10;
        }

        updateBalance();

        // Continue auto-spin if active
        if (isAutoSpinning && autoSpinCount > 0) {
          autoSpinCount--;
          document.getElementById('spin-count').innerText = autoSpinCount;

          if (autoSpinCount === 0) {
            stopAutoSpin();
          }
        }
      });

      gameSocket.on('balance-update', (data) => {
        if (data.credits !== undefined) {
          balance = data.credits;
          updateBalance();
        }
      });
    }

    // Show alerts in the UI
    function showAlert(message, type = "info") {
      const alertsDiv = document.getElementById('alerts');
      const messagesDiv = document.getElementById('alert-messages');

      // Create alert element
      const alertEl = document.createElement('div');
      alertEl.className = `alert ${type}`;
      alertEl.style.padding = "8px";
      alertEl.style.marginBottom = "8px";
      alertEl.style.borderLeft = type === "error" ? "4px solid #ff5555" :
        type === "success" ? "4px solid #50fa7b" :
          "4px solid #bd93f9";

      // Add timestamp
      const now = new Date();
      const timestamp = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;

      alertEl.innerHTML = `<small>[${timestamp}]</small> ${message}`;

      // Add to DOM
      messagesDiv.appendChild(alertEl);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // Show alerts container
      alertsDiv.style.display = 'block';
    }

    // Update balance display
    function updateBalance() {
      document.getElementById('balance').innerText = `Balance: $${balance}`;
    }

    // Update spin count
    function updateSpinCount(change) {
      autoSpinCount = Math.max(1, autoSpinCount + change);
      document.getElementById('spin-count').innerText = autoSpinCount;
    }

    // Spin function
    function spin() {
      if (!gameSocket || !gameSocket.connected) {
        showAlert("Please connect to the game first!", "error");
        return;
      }

      // Check balance
      if (balance < 10) {
        showAlert("Not enough balance to spin!", "error");
        stopAutoSpin();
        return;
      }

      // Send spin request to server
      gameSocket.emit('spin', { bet: 10 });
    }

    // Toggle auto-spin
    function toggleAutoSpin() {
      if (isAutoSpinning) {
        stopAutoSpin();
      } else {
        startAutoSpin();
      }
    }

    // Start auto-spin
    function startAutoSpin() {
      if (!gameSocket || !gameSocket.connected) {
        showAlert("Please connect to the game first!", "error");
        return;
      }

      isAutoSpinning = true;
      document.getElementById('auto-spin-btn').innerText = "Stop Auto";
      document.getElementById('auto-spin-btn').className = "spin-button secondary-button";

      // Initial spin
      spin();

      // Set interval for subsequent spins (every 2 seconds)
      autoSpinInterval = setInterval(() => {
        if (autoSpinCount > 0 && balance >= 10) {
          spin();
        } else {
          stopAutoSpin();
        }
      }, 2000);
    }

    // Stop auto-spin
    function stopAutoSpin() {
      isAutoSpinning = false;
      document.getElementById('auto-spin-btn').innerText = "Auto Spin";
      document.getElementById('auto-spin-btn').className = "spin-button secondary-button";

      if (autoSpinInterval) {
        clearInterval(autoSpinInterval);
        autoSpinInterval = null;
      }
    }
  </script>
</body>


</html>