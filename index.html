<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket.IO Platform & Game</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: #1e1e2e;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    .container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 2.5rem;
      color: #f8f8f2;
      text-align: center;
      text-shadow: 0 0 10px rgba(189, 147, 249, 0.7);
    }

    .status-cards {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      flex: 1;
      background: #282a36;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #bd93f9;
    }

    .status {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .connected {
      background-color: #50fa7b;
      color: #282a36;
    }

    .disconnected {
      background-color: #ff5555;
      color: #f8f8f2;
    }

    .login-panel {
      background: #282a36;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      width: 100%;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    input {
      flex: 1;
      padding: 12px 15px;
      border: none;
      background: #44475a;
      color: #f8f8f2;
      border-radius: 8px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s;
    }

    input:focus {
      box-shadow: 0 0 0 2px #bd93f9;
    }

    input::placeholder {
      color: #6272a4;
    }

    button {
      background: #bd93f9;
      color: #282a36;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
    }

    button:hover {
      background: #a58eed;
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .game-controls {
      background: #282a36;
      border-radius: 12px;
      padding: 25px;
      width: 100%;
      display: none;
    }

    .controls-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .controls-title {
      font-size: 1.5rem;
      color: #bd93f9;
    }

    .spin-buttons {
      display: flex;
      gap: 15px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .spin-button {
      flex: 1;
      min-width: 120px;
      padding: 15px;
      text-align: center;
    }

    .primary-button {
      background: linear-gradient(135deg, #bd93f9, #9580ec);
    }

    .secondary-button {
      background: linear-gradient(135deg, #8be9fd, #50fa7b);
    }

    .auto-spin-container {
      margin-top: 20px;
      background: #44475a;
      border-radius: 8px;
      padding: 15px;
    }

    .auto-spin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .spin-counter {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .counter-button {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #6272a4;
      border-radius: 4px;
      padding: 0;
    }

    #spin-count {
      font-size: 1.2rem;
      font-weight: 600;
      color: #f8f8f2;
    }

    .result-display {
      margin-top: 20px;
      background: #44475a;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }

    #result-text {
      font-size: 1.2rem;
      font-weight: 600;
      color: #f8f8f2;
    }

    .win {
      color: #50fa7b !important;
    }

    .lose {
      color: #ff5555 !important;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Slot Game Platform</h1>

    <div class="status-cards">
      <div class="card">
        <h2>Platform Connection</h2>
        <span id="platform-status" class="status disconnected">Disconnected</span>
      </div>
      <div class="card">
        <h2>Game Connection</h2>
        <span id="game-status" class="status disconnected">Disconnected</span>
      </div>
    </div>

    <div class="login-panel">
      <div class="input-group">
        <input type="text" id="username" placeholder="Enter your username">
        <button onclick="connectGame()">Connect to Game</button>
      </div>
    </div>

    <div id="game-controls" class="game-controls">
      <div class="controls-header">
        <h2 class="controls-title">Game Controls</h2>
        <span id="balance">Balance: $1000</span>
      </div>

      <div class="spin-buttons">
        <button onclick="spin()" class="spin-button primary-button">Spin</button>
        <button onclick="toggleAutoSpin()" id="auto-spin-btn" class="spin-button secondary-button">Auto Spin</button>
      </div>

      <div class="auto-spin-container">
        <div class="auto-spin-header">
          <h3>Auto Spin Count</h3>
          <div class="spin-counter">
            <button onclick="updateSpinCount(-1)" class="counter-button">-</button>
            <span id="spin-count">10</span>
            <button onclick="updateSpinCount(1)" class="counter-button">+</button>
          </div>
        </div>
      </div>

      <div class="result-display">
        <h3>Last Result</h3>
        <p id="result-text">Spin to see results</p>
      </div>
    </div>
  </div>

  <script>
    const platformSocket = io("http://localhost:5001/platform", { withCredentials: true });
    let gameSocket = null;
    let balance = 1000;
    let autoSpinCount = 10;
    let isAutoSpinning = false;
    let autoSpinInterval = null;

    // Update platform connection status
    platformSocket.on('connect', () => {
      document.getElementById('platform-status').innerText = "Connected";
      document.getElementById('platform-status').className = "status connected";
      console.log("✅ Connected to Platform Namespace");

      // Simulate a login event
      platformSocket.emit('login', { username: "Guest" });
    });

    platformSocket.on('disconnect', () => {
      document.getElementById('platform-status').innerText = "Disconnected";
      document.getElementById('platform-status').className = "status disconnected";
      console.log("❌ Disconnected from Platform Namespace");
    });

    // Connect to the game namespace
    function connectGame() {
      const username = document.getElementById('username').value.trim();
      if (!username) {
        alert("Please enter a username before connecting to the game!");
        return;
      }

      // Prevent multiple connections
      if (gameSocket) {
        gameSocket.disconnect();
      }

      gameSocket = io('http://localhost:5001/game', { withCredentials: true });

      gameSocket.on('connect', () => {
        document.getElementById('game-status').innerText = "Connected";
        document.getElementById('game-status').className = "status connected";
        console.log("🎮 Connected to Game Namespace");

        // Show game controls
        document.getElementById('game-controls').style.display = 'block';

        // Send username to the server
        gameSocket.emit('join', { username });
      });

      gameSocket.on('disconnect', () => {
        document.getElementById('game-status').innerText = "Disconnected";
        document.getElementById('game-status').className = "status disconnected";
        console.log("❌ Disconnected from Game Namespace");

        // Hide game controls
        document.getElementById('game-controls').style.display = 'none';

        // Stop auto-spin if active
        stopAutoSpin();
      });

      gameSocket.on('spin-result', (data) => {
        const resultElement = document.getElementById('result-text');
        resultElement.innerText = `${data.result}`;
        resultElement.className = data.result === 'Win' ? 'win' : 'lose';

        // Update balance based on result
        if (data.result === 'Win') {
          balance += 50;
        } else {
          balance -= 10;
        }

        updateBalance();

        // Continue auto-spin if active
        if (isAutoSpinning && autoSpinCount > 0) {
          autoSpinCount--;
          document.getElementById('spin-count').innerText = autoSpinCount;

          if (autoSpinCount === 0) {
            stopAutoSpin();
          }
        }
      });
    }

    // Update balance display
    function updateBalance() {
      document.getElementById('balance').innerText = `Balance: $${balance}`;
    }

    // Update spin count
    function updateSpinCount(change) {
      autoSpinCount = Math.max(1, autoSpinCount + change);
      document.getElementById('spin-count').innerText = autoSpinCount;
    }

    // Spin function
    function spin() {
      if (!gameSocket || !gameSocket.connected) {
        alert("Please connect to the game first!");
        return;
      }

      // Check balance
      if (balance < 10) {
        alert("Not enough balance to spin!");
        stopAutoSpin();
        return;
      }

      // Send spin request to server
      gameSocket.emit('spin', { bet: 10 });
    }

    // Toggle auto-spin
    function toggleAutoSpin() {
      if (isAutoSpinning) {
        stopAutoSpin();
      } else {
        startAutoSpin();
      }
    }

    // Start auto-spin
    function startAutoSpin() {
      if (!gameSocket || !gameSocket.connected) {
        alert("Please connect to the game first!");
        return;
      }

      isAutoSpinning = true;
      document.getElementById('auto-spin-btn').innerText = "Stop Auto";
      document.getElementById('auto-spin-btn').className = "spin-button secondary-button";

      // Initial spin
      spin();

      // Set interval for subsequent spins (every 2 seconds)
      autoSpinInterval = setInterval(() => {
        if (autoSpinCount > 0 && balance >= 10) {
          spin();
        } else {
          stopAutoSpin();
        }
      }, 2000);
    }

    // Stop auto-spin
    function stopAutoSpin() {
      isAutoSpinning = false;
      document.getElementById('auto-spin-btn').innerText = "Auto Spin";
      document.getElementById('auto-spin-btn').className = "spin-button secondary-button";

      if (autoSpinInterval) {
        clearInterval(autoSpinInterval);
        autoSpinInterval = null;
      }
    }
  </script>
</body>

</html>